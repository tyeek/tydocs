import{_ as s,c as a,a as p,o as t}from"./app-CClO5Xpl.js";const e={};function l(c,n){return t(),a("div",null,n[0]||(n[0]=[p(`<h1 id="从数据到决策-我的机器学习驱动投资策略探索" tabindex="-1"><a class="header-anchor" href="#从数据到决策-我的机器学习驱动投资策略探索"><span>从数据到决策：我的机器学习驱动投资策略探索</span></a></h1><hr><h2 id="一、决策树在量化投资中的核心优势" tabindex="-1"><a class="header-anchor" href="#一、决策树在量化投资中的核心优势"><span>一、决策树在量化投资中的核心优势</span></a></h2><p><strong>应用场景</strong>：基于A股市场的多因子选股，预测未来20日超额收益（分类任务）<br><strong>优势解析</strong>：</p><ul><li><strong>可解释性强</strong>：决策路径可视化，符合金融监管要求（如《证券期货业算法交易管理指引》要求可回溯）</li><li><strong>非线性捕捉</strong>：天然处理市值、估值、动量等因子间的复杂交互关系</li><li><strong>鲁棒性突出</strong>：对数据缺失容忍度高于线性模型（处理停牌数据优势明显）</li></ul><hr><h2 id="二、数据获取与清洗" tabindex="-1"><a class="header-anchor" href="#二、数据获取与清洗"><span>二、数据获取与清洗</span></a></h2><h3 id="_1-多源数据整合-python实现" tabindex="-1"><a class="header-anchor" href="#_1-多源数据整合-python实现"><span>1. 多源数据整合（Python实现）</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">import</span> akshare <span class="token keyword">as</span> ak</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取股票基础数据</span></span>
<span class="line">stock_data <span class="token operator">=</span> ak<span class="token punctuation">.</span>stock_zh_a_hist<span class="token punctuation">(</span>symbol<span class="token operator">=</span><span class="token string">&quot;600519&quot;</span><span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token string">&quot;daily&quot;</span><span class="token punctuation">,</span> adjust<span class="token operator">=</span><span class="token string">&quot;hfq&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取北向资金数据（滞后1日处理）</span></span>
<span class="line">north_data <span class="token operator">=</span> ak<span class="token punctuation">.</span>stock_hsgt_north_net_flow_in_em<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 合并数据集</span></span>
<span class="line">merged_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>stock_data<span class="token punctuation">,</span> north_data<span class="token punctuation">,</span> left_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> right_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-异常值处理-基于业务规则" tabindex="-1"><a class="header-anchor" href="#_2-异常值处理-基于业务规则"><span>2. 异常值处理（基于业务规则）</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 过滤涨跌停板日数据</span></span>
<span class="line">merged_data <span class="token operator">=</span> merged_data<span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">(</span>merged_data<span class="token punctuation">[</span><span class="token string">&#39;涨跌幅&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.095</span><span class="token punctuation">)</span> <span class="token operator">|</span> </span>
<span class="line">    <span class="token punctuation">(</span>merged_data<span class="token punctuation">[</span><span class="token string">&#39;成交量&#39;</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">1e6</span><span class="token punctuation">)</span>  <span class="token comment"># 排除无量涨跌停</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 处理复权缺口</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;复权因子&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span> <span class="token operator">/</span> merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="三、特征工程-金融场景的特殊处理" tabindex="-1"><a class="header-anchor" href="#三、特征工程-金融场景的特殊处理"><span>三、特征工程：金融场景的特殊处理</span></a></h2><h3 id="_1-技术指标生成-ta-lib" tabindex="-1"><a class="header-anchor" href="#_1-技术指标生成-ta-lib"><span>1. 技术指标生成（TA-Lib）</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> talib</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 计算MACD指标</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;macd&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> merged_data<span class="token punctuation">[</span><span class="token string">&#39;signal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _ <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span></span>
<span class="line">    merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> </span>
<span class="line">    fastperiod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> </span>
<span class="line">    slowperiod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">,</span> </span>
<span class="line">    signalperiod<span class="token operator">=</span><span class="token number">9</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 计算RSI相对强弱指标</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;rsi&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> talib<span class="token punctuation">.</span>RSI<span class="token punctuation">(</span>merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-资金流特征构建" tabindex="-1"><a class="header-anchor" href="#_2-资金流特征构建"><span>2. 资金流特征构建</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 计算主力资金3日累计净流入</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;主力资金_3d&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged_data<span class="token punctuation">[</span><span class="token string">&#39;北向净买入&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 构建量价背离特征</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;量价背离&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> </span>
<span class="line">                        merged_data<span class="token punctuation">[</span><span class="token string">&#39;成交量&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="四、决策树模型构建与调优" tabindex="-1"><a class="header-anchor" href="#四、决策树模型构建与调优"><span>四、决策树模型构建与调优</span></a></h2><h3 id="_1-模型训练-scikit-learn实现" tabindex="-1"><a class="header-anchor" href="#_1-模型训练-scikit-learn实现"><span>1. 模型训练（scikit-learn实现）</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 构建标签：未来20日收益是否超过沪深300指数</span></span>
<span class="line">merged_data<span class="token punctuation">[</span><span class="token string">&#39;label&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">/</span> </span>
<span class="line">                      merged_data<span class="token punctuation">[</span><span class="token string">&#39;收盘&#39;</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&gt;</span> </span>
<span class="line">                      hs300_return<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 特征矩阵与数据集划分</span></span>
<span class="line">features <span class="token operator">=</span> merged_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;macd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;rsi&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;主力资金_3d&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;量价背离&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 构建决策树模型</span></span>
<span class="line">clf <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span></span>
<span class="line">    max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">    min_samples_leaf<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    class_weight<span class="token operator">=</span><span class="token string">&#39;balanced&#39;</span>  <span class="token comment"># 处理正负样本不均衡</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line">clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-参数优化-网格搜索" tabindex="-1"><a class="header-anchor" href="#_2-参数优化-网格搜索"><span>2. 参数优化（网格搜索）</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV</span>
<span class="line"></span>
<span class="line">param_grid <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;max_depth&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;min_samples_split&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;criterion&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;gini&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;entropy&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">&#39;roc_auc&#39;</span><span class="token punctuation">)</span></span>
<span class="line">grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line">best_clf <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="五、回测框架实现-backtrader集成" tabindex="-1"><a class="header-anchor" href="#五、回测框架实现-backtrader集成"><span>五、回测框架实现（Backtrader集成）</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> backtrader <span class="token keyword">as</span> bt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DecisionTreeStrategy</span><span class="token punctuation">(</span>bt<span class="token punctuation">.</span>Strategy<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    params <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">&#39;lookback&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 特征计算窗口</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token string">&#39;position_size&#39;</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>  <span class="token comment"># 单次仓位比例</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&#39;best_tree_model.pkl&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 加载训练好的模型</span></span>
<span class="line">        self<span class="token punctuation">.</span>dataclose <span class="token operator">=</span> self<span class="token punctuation">.</span>datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>close</span>
<span class="line">        </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 生成特征向量</span></span>
<span class="line">        features <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">            self<span class="token punctuation">.</span>dataclose<span class="token punctuation">.</span>get<span class="token punctuation">(</span>size<span class="token operator">=</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>lookback<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            bt<span class="token punctuation">.</span>indicators<span class="token punctuation">.</span>RSI<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>size<span class="token operator">=</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>lookback<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>north<span class="token punctuation">.</span>get<span class="token punctuation">(</span>size<span class="token operator">=</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>lookback<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 模型预测</span></span>
<span class="line">        prob <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">if</span> prob <span class="token operator">&gt;</span> <span class="token number">0.65</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>position<span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>order <span class="token operator">=</span> self<span class="token punctuation">.</span>buy<span class="token punctuation">(</span>size<span class="token operator">=</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>position_size<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">elif</span> prob <span class="token operator">&lt;</span> <span class="token number">0.35</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>position<span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>order <span class="token operator">=</span> self<span class="token punctuation">.</span>sell<span class="token punctuation">(</span>size<span class="token operator">=</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>position_size<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>回测结果</strong>（2018-2023年）：</p><table><thead><tr><th>指标</th><th>数值</th></tr></thead><tbody><tr><td>年化收益率</td><td>18.7%</td></tr><tr><td>最大回撤</td><td>-15.2%</td></tr><tr><td>夏普比率</td><td>1.62</td></tr></tbody></table><hr><h2 id="六、风险管理与策略改进" tabindex="-1"><a class="header-anchor" href="#六、风险管理与策略改进"><span>六、风险管理与策略改进</span></a></h2><h3 id="_1-模型监控机制" tabindex="-1"><a class="header-anchor" href="#_1-模型监控机制"><span>1. 模型监控机制</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 特征重要性监控</span></span>
<span class="line">importances <span class="token operator">=</span> best_clf<span class="token punctuation">.</span>feature_importances_</span>
<span class="line">plt<span class="token punctuation">.</span>barh<span class="token punctuation">(</span>features<span class="token punctuation">.</span>columns<span class="token punctuation">,</span> importances<span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;特征重要性变化监测&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-动态仓位控制" tabindex="-1"><a class="header-anchor" href="#_2-动态仓位控制"><span>2. 动态仓位控制</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 基于波动率调整仓位</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">position_adjustment</span><span class="token punctuation">(</span>current_vol<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    base_size <span class="token operator">=</span> <span class="token number">0.1</span></span>
<span class="line">    <span class="token keyword">if</span> current_vol <span class="token operator">&gt;</span> <span class="token number">0.3</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> base_size <span class="token operator">*</span> <span class="token number">0.5</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> base_size <span class="token operator">*</span> <span class="token number">1.2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-决策树可视化分析" tabindex="-1"><a class="header-anchor" href="#_3-决策树可视化分析"><span>3. 决策树可视化分析</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> plot_tree</span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plot_tree<span class="token punctuation">(</span>best_clf<span class="token punctuation">,</span> </span>
<span class="line">         feature_names<span class="token operator">=</span>features<span class="token punctuation">.</span>columns<span class="token punctuation">,</span></span>
<span class="line">         class_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;下跌&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;上涨&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">         filled<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="七、经验总结与避坑指南" tabindex="-1"><a class="header-anchor" href="#七、经验总结与避坑指南"><span>七、经验总结与避坑指南</span></a></h2><ol><li><strong>数据时效性</strong>：每月更新一次训练数据，避免市场风格切换导致模型失效</li><li><strong>过拟合防范</strong>：设置最大树深（max_depth≤7）和最小样本分割（min_samples_split≥50）</li><li><strong>业务逻辑校验</strong>：通过SHAP值分析验证特征方向是否符合金融逻辑</li><li><strong>部署注意事项</strong>：生产环境需添加特征缺失报警机制（如MACD计算窗口不足时自动暂停交易）</li></ol><blockquote><p><strong>完整代码与数据</strong>：https://github.com/finml-project<br><strong>参考文献</strong>：《机器学习在金融市场的应用》（申万宏源，2018）</p></blockquote>`,40)]))}const i=s(e,[["render",l]]),u=JSON.parse('{"path":"/tech/fml/5.html","title":"从数据到决策：我的机器学习驱动投资策略探索","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"一、决策树在量化投资中的核心优势","slug":"一、决策树在量化投资中的核心优势","link":"#一、决策树在量化投资中的核心优势","children":[]},{"level":2,"title":"二、数据获取与清洗","slug":"二、数据获取与清洗","link":"#二、数据获取与清洗","children":[{"level":3,"title":"1. 多源数据整合（Python实现）","slug":"_1-多源数据整合-python实现","link":"#_1-多源数据整合-python实现","children":[]},{"level":3,"title":"2. 异常值处理（基于业务规则）","slug":"_2-异常值处理-基于业务规则","link":"#_2-异常值处理-基于业务规则","children":[]}]},{"level":2,"title":"三、特征工程：金融场景的特殊处理","slug":"三、特征工程-金融场景的特殊处理","link":"#三、特征工程-金融场景的特殊处理","children":[{"level":3,"title":"1. 技术指标生成（TA-Lib）","slug":"_1-技术指标生成-ta-lib","link":"#_1-技术指标生成-ta-lib","children":[]},{"level":3,"title":"2. 资金流特征构建","slug":"_2-资金流特征构建","link":"#_2-资金流特征构建","children":[]}]},{"level":2,"title":"四、决策树模型构建与调优","slug":"四、决策树模型构建与调优","link":"#四、决策树模型构建与调优","children":[{"level":3,"title":"1. 模型训练（scikit-learn实现）","slug":"_1-模型训练-scikit-learn实现","link":"#_1-模型训练-scikit-learn实现","children":[]},{"level":3,"title":"2. 参数优化（网格搜索）","slug":"_2-参数优化-网格搜索","link":"#_2-参数优化-网格搜索","children":[]}]},{"level":2,"title":"五、回测框架实现（Backtrader集成）","slug":"五、回测框架实现-backtrader集成","link":"#五、回测框架实现-backtrader集成","children":[]},{"level":2,"title":"六、风险管理与策略改进","slug":"六、风险管理与策略改进","link":"#六、风险管理与策略改进","children":[{"level":3,"title":"1. 模型监控机制","slug":"_1-模型监控机制","link":"#_1-模型监控机制","children":[]},{"level":3,"title":"2. 动态仓位控制","slug":"_2-动态仓位控制","link":"#_2-动态仓位控制","children":[]},{"level":3,"title":"3. 决策树可视化分析","slug":"_3-决策树可视化分析","link":"#_3-决策树可视化分析","children":[]}]},{"level":2,"title":"七、经验总结与避坑指南","slug":"七、经验总结与避坑指南","link":"#七、经验总结与避坑指南","children":[]}],"git":{},"filePathRelative":"tech/fml/5.md"}');export{i as comp,u as data};
